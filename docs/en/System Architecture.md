
This is the first section of the second chapter in the **BlockEmulator** English documentation. 

**BlockEmulator** adopts a layered approach to its design, with each layer responsible for independent transactions and interacting only with its adjacent layers as much as possible. This achieves a functional structure at the system level, helping users to quickly become familiar with the system and enabling code reuse and modification. The entire architecture can be divided into five specific levels, which can be divided into the following based on the proximity of real data (transaction data): storage layer, data layer, network layer, consensus layer, and Utilization layer.

1. **Storage Layer**: This layer is mainly responsible for the persistent storage of data. In this layer, the simulated blockchain storage data content and related storage forms will be designed, including block storage, blockchain state tree storage, public-private key storage, etc. The storage layer's functionality is implemented based on the boltDB database.

2. **Data Layer**: This layer mainly defines the specific form of data in the system. In this layer, Various data structures in the simulated blockchain, including blockchain accounts, transactions, blocks, state trees, nodes, etc., will be described. The content of this layer will actively interact with the storage layer. As the simulated blockchain runs, account information, transaction information, and block information will be continuously handed over to the storage layer for storage. In some cases (such as replaying the system from a certain moment), the data layer may also read content from the storage layer to instantiate data. The data layer also provides data operation-related functions, such as encoding and decoding of data.

3. **Network Layer**: This layer mainly defines and controls end-to-end packet transmission. End-to-end packet transmission in this invention system includes network communication methods, broadcast methods, network information encoding and decoding methods, etc. Control of end-to-end packet transmission mainly focuses on controlling the transmission bandwidth of control entities (blockchain nodes). The system achieves this by controlling the sending frequency of messages by consensus nodes at a certain moment, such as reducing the message frequency from ten messages per second to one message per second. In addition, the size of messages can also be controlled. The interaction between the network layer and the data layer includes transmitting various transaction data and block information in the network layer.

4. **Consensus Layer**: This layer mainly defines and runs two types of protocols, including intra-shard consensus and inter-shard consensus. Intra-shard consensus mainly maintains data consistency among nodes within a shard, while inter-shard consensus mainly maintains the consistency of data involved in cross-shard transaction behavior. The consensus layer mainly runs on the basis of the network layer, as the operation of consensus requires continuous sending of various messages and communication interaction between nodes.

5. **Utilization Layer**: This layer is mainly responsible for the overall operation of the system. Before the system runs, it reads local data, input parameter settings, and prepares the running environment, including constructing blockchain nodes, etc. During system operation, it ensures that transaction data is injected according to parameter settings, data exchange is stable, and logs and experimental data are saved. After the system runs, it can draw relevant charts based on the saved experimental data, such as the blockchain throughput over time.
   
      <img src ="https://github.com/HuangLab-SYSU/block-emulator/blob/main/docs/en/SystemArch.png" width= 500>

  <center>The Hier Architecture of BlockEmulator </center>
